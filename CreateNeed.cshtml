@{
    Layout = "~/_SiteLayout.cshtml";
    Page.Title = "Updates";    
    
     
    var needID = UrlData[0];
    var id = 0;
    if (!needID.IsEmpty() && needID.IsInt()) {
        id = Convert.ToInt32(needID);
    }

    Validation.RequireField("NeedTitle", "Please provide a title for this need.");
    Validation.RequireField("VideoUpload", "Please upload a video for this need. This should be 30-60 seconds in length.");
    Validation.RequireField("Description", "Please provide a description for this need.");
    Validation.RequireField("DeadlineDate", "Please indicate when this need should be met by.");

    var db = Database.Open("GoodStarter");
    var needInfo = db.QuerySingle("SELECT * FROM Need WHERE NeedID = @0", id);
    var userInfo = db.QuerySingle("SELECT * FROM UserProfile WHERE UserId = @0", needInfo.CreatorID);

    if (IsPost) {
        if (Validation.IsValid()) {
            var title = Request.Form["NeedTitle"];
            var video = Request.Form["VideoUpload"];
            var creationDate = DateTime.Now;
            var deadlineDate = Request.Form["DeadlineDate"];
            var description = Request.Form["Description"];
            var isMet = false;
            var category = Request.Form["Category"];
            var sql = "INSERT INTO Need (NeedID, Title, Text, PostDate) VALUES (@0, @1, @2, @3)";

            db.Execute(sql, needID, title, text, postDate);

            Response.Redirect("~/UploadSuccess/" + needID);
        }
    }
}

<section class="description">
    <div class="row">
        <div class="col-md-8">
            <div class="updates">
                <form method="post">
                    <div class="sub-title row">
                        <label for="NeedTitle">Title</label> @Html.ValidationMessage("NeedTitle")<br />
                        <h2>
                            <input type="text" name="NeedTitle" value="@Request.Form["NeedTitle"]" />
                        </h2>
                    </div>
                    <div class="row">
                        <label for="UpdateText">Video Upload</label> @Html.ValidationMessage("UpdateText")<br />
                        <textarea name="UpdateText" placeholder="Upload your video!" cols="75" rows="5">@Request.Unvalidated.Form["UpdateText"]</textarea>
                    </div>
                    <div class="row">
                        <input type="submit" value="Submit" class="submit float-right"/>
                    </div>
                </form>
            </div>
            @foreach (var update in updatePosts) {
                <div class="updates">
                    <div class="sub-title row">
                        <h2 class="float-left"> @update.Title </h2>
                        <p class="float-right"> @update.PostDate.ToShortDateString() </p>
                    </div>
                    <p> @update.Text </p>
                </div>
            }
        </div>
</section>

@RenderPage("NeedNav.cshtml")